<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CalciLab - Scientific Calculator Hub</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #050508;
      --bg-elevated: #0c0c12;
      --fg: #e8e8f0;
      --muted: #5a5a70;
      --accent: #00ffc8;
      --accent-dim: rgba(0, 255, 200, 0.1);
      --accent-glow: rgba(0, 255, 200, 0.4);
      --card: #0f0f16;
      --border: #1a1a24;
      --danger: #ff4d6a;
    }

    * { box-sizing: border-box; }

    body {
      font-family: 'JetBrains Mono', monospace;
      background: var(--bg);
      color: var(--fg);
      overflow-x: hidden;
    }

    h1, h2, h3, h4, h5, h6, .font-display {
      font-family: 'Space Grotesk', sans-serif;
    }

    /* Canvas Background */
    #networkCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      opacity: 0.5;
    }

    .glass-panel {
      background: rgba(12, 12, 18, 0.85);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
    }

    .calc-card {
      background: var(--card);
      border: 1px solid var(--border);
      padding: 20px;
      transition: all 0.2s ease-out;
      cursor: pointer;
      position: relative;
    }

    .calc-card::after {
      content: '';
      position: absolute;
      bottom: 0; left: 0;
      width: 0; height: 2px;
      background: var(--accent);
      transition: width 0.3s ease;
    }

    .calc-card:hover {
      border-color: var(--accent);
      background: #12121a;
    }

    .calc-card:hover::after {
      width: 100%;
    }

    .category-pill {
      padding: 8px 16px;
      border-radius: 2px;
      background: transparent;
      border: 1px solid var(--border);
      color: var(--muted);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      transition: all 0.2s;
    }

    .category-pill:hover, .category-pill.active {
      background: var(--accent);
      color: var(--bg);
      border-color: var(--accent);
      font-weight: 600;
    }

    .btn-primary {
      padding: 10px 20px;
      background: var(--accent);
      color: var(--bg);
      font-weight: 600;
      border-radius: 2px;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-primary:hover { box-shadow: 0 0 20px var(--accent-glow); }

    .input-field {
      width: 100%;
      padding: 12px;
      background: var(--bg);
      border: 1px solid var(--border);
      color: var(--fg);
      font-family: 'JetBrains Mono', monospace;
      border-radius: 2px;
      font-size: 14px;
    }

    .input-field:focus {
      outline: none;
      border-color: var(--accent);
    }

    .input-label {
      display: block;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--muted);
      margin-bottom: 6px;
    }

    /* Modal System */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
    }

    .modal-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    .modal-content {
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      width: 95%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      transform: translateY(20px) scale(0.98);
      transition: transform 0.3s;
    }

    .modal-overlay.active .modal-content {
      transform: translateY(0) scale(1);
    }

    .result-display {
      background: var(--bg);
      border: 1px solid var(--border);
      padding: 20px;
      font-size: 24px;
      font-family: 'Space Grotesk', sans-serif;
      font-weight: 700;
      color: var(--accent);
      text-align: right;
      min-height: 70px;
      display: flex;
      align-items: center;
      justify-content: flex-end;
    }

    .auth-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--fg);
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .auth-btn:hover { background: var(--card); }

    .user-avatar {
      width: 32px; height: 32px;
      border-radius: 50%;
      background: var(--accent-dim);
      display: flex; align-items: center; justify-content: center;
      font-weight: 600; color: var(--accent);
      border: 1px solid var(--accent);
      cursor: pointer;
      font-size: 12px;
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg); }
    ::-webkit-scrollbar-thumb { background: var(--border); }

    @media (max-width: 640px) {
      .modal-content { width: 100%; height: 100%; max-height: 100%; }
    }
  </style>
</head>
<body class="min-h-screen">
  <canvas id="networkCanvas"></canvas>

  <!-- Header -->
  <header class="sticky top-0 z-50 glass-panel border-b border-[var(--border)]">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <a href="#" class="flex items-center gap-3 group" onclick="resetView(); return false;">
          <div class="w-8 h-8 flex items-center justify-center text-[var(--accent)]">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
              <path d="M8 7h8M8 11h8M8 15h4"/>
            </svg>
          </div>
          <span class="text-lg font-bold tracking-tight font-display">CalciLab</span>
        </a>

        <div class="flex items-center gap-4">
          <div class="relative hidden sm:block">
             <input type="text" id="headerSearch" placeholder="Search..." class="input-field py-2 px-3 text-xs w-40" onkeyup="handleSearch(this.value)">
          </div>
          <div id="authArea">
            <!-- Auth State Injected Here -->
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="relative z-10 py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      
      <!-- Categories -->
      <div class="flex flex-wrap gap-2 mb-8 pb-6 border-b border-[var(--border)]" id="categoriesContainer">
        <button class="category-pill active" data-category="all">All Calculators</button>
        <button class="category-pill" data-category="financial">Financial</button>
        <button class="category-pill" data-category="math">Math</button>
        <button class="category-pill" data-category="health">Health</button>
        <button class="category-pill" data-category="other">Other</button>
      </div>

      <!-- Calculator Grid -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-px bg-[var(--border)]" id="calcGrid">
        <!-- Injected via JS -->
      </div>
      
      <div id="emptyState" class="hidden text-center py-16 text-[var(--muted)]">
        No calculators found.
      </div>
    </div>
  </main>

  <!-- Auth Modal -->
  <div id="authModal" class="modal-overlay" onclick="if(event.target === this) closeAuthModal();">
    <div class="modal-content p-8" onclick="event.stopPropagation()">
      <div class="text-center mb-8">
        <h2 class="text-xl font-bold font-display mb-2">Sign In</h2>
        <p class="text-[var(--muted)] text-sm">Save your history and preferences</p>
      </div>
      <div class="space-y-3">
        <button onclick="signIn('google')" class="auth-btn"><svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg> Continue with Google</button>
        <button onclick="signIn('github')" class="auth-btn"><svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg> Continue with GitHub</button>
      </div>
      <button onclick="closeAuthModal()" class="w-full mt-6 text-xs text-[var(--muted)] hover:text-[var(--fg)]">Cancel</button>
    </div>
  </div>

  <!-- Calculator Modal -->
  <div id="calcModal" class="modal-overlay" onclick="if(event.target === this) closeCalcModal();">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="p-4 border-b border-[var(--border)] flex justify-between items-center bg-[var(--card)]">
        <div>
          <h3 class="font-bold font-display" id="modalTitle">Calculator</h3>
          <p class="text-[10px] text-[var(--muted)] uppercase tracking-widest" id="modalCategory">Category</p>
        </div>
        <button onclick="closeCalcModal()" class="p-1 hover:text-[var(--accent)]">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
        </button>
      </div>
      
      <!-- Dynamic Interface -->
      <div class="p-6">
        <div id="calcInterface" class="space-y-4">
          <!-- Inputs Generated Here -->
        </div>
        
        <div class="mt-6">
           <button onclick="calculateResult()" class="btn-primary w-full">Calculate</button>
        </div>
        
        <div class="mt-6 result-display" id="resultDisplay">
          0
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- DATA: Calculator Definitions ---
    // Based on the uploaded image content
    const calculators = [
      // --- FINANCIAL ---
      { id: 'mortgage', name: 'Mortgage Calculator', category: 'financial', inputs: [
        { id: 'loan', label: 'Loan Amount ($)', type: 'number', placeholder: '300,000' },
        { id: 'rate', label: 'Interest Rate (%)', type: 'number', placeholder: '3.5' },
        { id: 'years', label: 'Loan Term (Years)', type: 'number', placeholder: '30' }
      ], formula: (i) => { 
        const P = i.loan; const r = (i.rate/100)/12; const n = i.years*12;
        const m = P * (r * Math.pow(1+r, n)) / (Math.pow(1+r, n) - 1);
        return `$${m.toFixed(2)} / month`;
      }},
      { id: 'loan', name: 'Loan Calculator', category: 'financial', inputs: [
        { id: 'amount', label: 'Loan Amount ($)', type: 'number' },
        { id: 'rate', label: 'Interest Rate (%)', type: 'number' },
        { id: 'months', label: 'Term (Months)', type: 'number' }
      ], formula: (i) => {
        const P = i.amount; const r = (i.rate/100)/12;
        const m = P * (r * Math.pow(1+r, i.months)) / (Math.pow(1+r, i.months) - 1);
        return `Monthly Payment: $${m.toFixed(2)}`;
      }},
      { id: 'auto_loan', name: 'Auto Loan Calculator', category: 'financial', inputs: [
        { id: 'price', label: 'Vehicle Price ($)', type: 'number' },
        { id: 'down', label: 'Down Payment ($)', type: 'number' },
        { id: 'rate', label: 'Rate (%)', type: 'number' },
        { id: 'years', label: 'Term (Years)', type: 'number' }
      ], formula: (i) => {
        const P = i.price - i.down; const r = (i.rate/100)/12; const n = i.years*12;
        const m = P * (r * Math.pow(1+r, n)) / (Math.pow(1+r, n) - 1);
        return `Monthly: $${m.toFixed(2)}`;
      }},
      { id: 'interest', name: 'Interest Calculator', category: 'financial', inputs: [
        { id: 'principal', label: 'Principal ($)', type: 'number' },
        { id: 'rate', label: 'Annual Rate (%)', type: 'number' },
        { id: 'time', label: 'Time (Years)', type: 'number' }
      ], formula: (i) => {
        const interest = (i.principal * i.rate * i.time) / 100;
        return `Simple Interest: $${interest.toFixed(2)}`;
      }},
      { id: 'investment', name: 'Investment Calculator', category: 'financial', inputs: [
        { id: 'start', label: 'Starting Amount ($)', type: 'number' },
        { id: 'monthly', label: 'Monthly Contribution ($)', type: 'number' },
        { id: 'rate', label: 'Annual Return (%)', type: 'number' },
        { id: 'years', label: 'Years', type: 'number' }
      ], formula: (i) => {
        const r = (i.rate/100)/12; const n = i.years*12;
        const fv = i.start * Math.pow(1+r, n) + i.monthly * ((Math.pow(1+r, n) - 1) / r);
        return `Future Value: $${fv.toFixed(2)}`;
      }},
      { id: 'roi', name: 'ROI Calculator', category: 'financial', inputs: [
        { id: 'gain', label: 'Final Value ($)', type: 'number' },
        { id: 'cost', label: 'Initial Cost ($)', type: 'number' }
      ], formula: (i) => {
        const roi = ((i.gain - i.cost) / i.cost) * 100;
        return `ROI: ${roi.toFixed(2)}%`;
      }},

      // --- MATH ---
      { id: 'scientific', name: 'Scientific Calculator', category: 'math', inputs: [
        { id: 'exp', label: 'Expression (e.g. Math.sin(1))', type: 'text', placeholder: 'Math.PI * 2' }
      ], formula: (i) => {
        try { return `Result: ${eval(i.exp)}`; } catch(e) { return 'Error'; }
      }},
      { id: 'percentage', name: 'Percentage Calculator', category: 'math', inputs: [
        { id: 'percent', label: 'Percentage (%)', type: 'number' },
        { id: 'of', label: 'Of Number', type: 'number' }
      ], formula: (i) => {
        return `Result: ${(i.percent / 100) * i.of}`;
      }},
      { id: 'fraction', name: 'Fraction Calculator', category: 'math', inputs: [
        { id: 'n1', label: 'Numerator 1', type: 'number' },
        { id: 'd1', label: 'Denominator 1', type: 'number' },
        { id: 'op', label: 'Operation (+, -, *, /)', type: 'text' },
        { id: 'n2', label: 'Numerator 2', type: 'number' },
        { id: 'd2', label: 'Denominator 2', type: 'number' }
      ], formula: (i) => {
        // Basic fraction logic simplified
        const v1 = i.n1/i.d1; const v2 = i.n2/i.d2;
        let res = 0;
        if(i.op === '+') res = v1+v2;
        else if(i.op === '-') res = v1-v2;
        else if(i.op === '*') res = v1*v2;
        else if(i.op === '/') res = v1/v2;
        return `Decimal Result: ${res.toFixed(4)}`;
      }},
      { id: 'std_dev', name: 'Standard Deviation', category: 'math', inputs: [
        { id: 'nums', label: 'Numbers (comma separated)', type: 'text', placeholder: '1, 2, 3, 4, 5' }
      ], formula: (i) => {
        const arr = i.nums.split(',').map(Number);
        const mean = arr.reduce((a,b)=>a+b,0)/arr.length;
        const sqDiffs = arr.map(x => Math.pow(x-mean, 2));
        const avgSqDiff = sqDiffs.reduce((a,b)=>a+b,0)/arr.length;
        return `Std Dev: ${Math.sqrt(avgSqDiff).toFixed(4)}`;
      }},
      { id: 'volume', name: 'Volume Calculator', category: 'math', inputs: [
        { id: 'shape', label: 'Shape (sphere, cube, cylinder)', type: 'text', placeholder: 'sphere' },
        { id: 'r', label: 'Radius/Size', type: 'number' }
      ], formula: (i) => {
        let vol = 0;
        if(i.shape === 'sphere') vol = (4/3)*Math.PI*Math.pow(i.r,3);
        else if(i.shape === 'cube') vol = Math.pow(i.r,3);
        else if(i.shape === 'cylinder') vol = Math.PI*Math.pow(i.r,2)*i.r; // assuming h=r for simplicity
        return `Volume: ${vol.toFixed(2)}`;
      }},

      // --- HEALTH ---
      { id: 'bmi', name: 'BMI Calculator', category: 'health', inputs: [
        { id: 'weight', label: 'Weight (kg)', type: 'number' },
        { id: 'height', label: 'Height (cm)', type: 'number' }
      ], formula: (i) => {
        const bmi = i.weight / Math.pow(i.height/100, 2);
        let cat = 'Normal';
        if(bmi < 18.5) cat = 'Underweight';
        else if(bmi > 25) cat = 'Overweight';
        else if(bmi > 30) cat = 'Obese';
        return `BMI: ${bmi.toFixed(1)} (${cat})`;
      }},
      { id: 'body_fat', name: 'Body Fat Calculator', category: 'health', inputs: [
        { id: 'gender', label: 'Gender (m/f)', type: 'text' },
        { id: 'height', label: 'Height (cm)', type: 'number' },
        { id: 'neck', label: 'Neck (cm)', type: 'number' },
        { id: 'waist', label: 'Waist (cm)', type: 'number' }
      ], formula: (i) => {
        // US Navy Method simplified
        let bf = 0;
        if(i.gender === 'm') bf = 495 / (1.0324 - 0.19077*Math.log10(i.waist - i.neck) + 0.15456*Math.log10(i.height)) - 450;
        else bf = 495 / (1.29579 - 0.35004*Math.log10(i.waist + 4.15 - i.neck) + 0.22100*Math.log10(i.height)) - 450;
        return `Body Fat: ${bf.toFixed(1)}%`;
      }},
      { id: 'calorie', name: 'Calorie Calculator', category: 'health', inputs: [
        { id: 'age', label: 'Age', type: 'number' },
        { id: 'gender', label: 'Gender (m/f)', type: 'text' },
        { id: 'weight', label: 'Weight (kg)', type: 'number' },
        { id: 'height', label: 'Height (cm)', type: 'number' }
      ], formula: (i) => {
        // Mifflin-St Jeor
        let bmr = 0;
        if(i.gender === 'm') bmr = 10*i.weight + 6.25*i.height - 5*i.age + 5;
        else bmr = 10*i.weight + 6.25*i.height - 5*i.age - 161;
        return `Daily Calories: ${bmr.toFixed(0)} kcal`;
      }},
      { id: 'pregnancy', name: 'Pregnancy Calculator', category: 'health', inputs: [
        { id: 'lmp', label: 'Last Period Date', type: 'date' }
      ], formula: (i) => {
        const d = new Date(i.lmp);
        d.setDate(d.getDate() + 280);
        return `Due Date: ${d.toDateString()}`;
      }},

      // --- OTHER ---
      { id: 'age', name: 'Age Calculator', category: 'other', inputs: [
        { id: 'dob', label: 'Date of Birth', type: 'date' }
      ], formula: (i) => {
        const dob = new Date(i.dob);
        const diff = Date.now() - dob.getTime();
        const ageDt = new Date(diff);
        return `Age: ${Math.abs(ageDt.getUTCFullYear() - 1970)} Years`;
      }},
      { id: 'date', name: 'Date Calculator', category: 'other', inputs: [
        { id: 'start', label: 'Start Date', type: 'date' },
        { id: 'end', label: 'End Date', type: 'date' }
      ], formula: (i) => {
        const d1 = new Date(i.start); const d2 = new Date(i.end);
        const diff = Math.abs(d2 - d1);
        return `Difference: ${Math.ceil(diff / (1000 * 60 * 60 * 24))} Days`;
      }},
      { id: 'time', name: 'Time Calculator', category: 'other', inputs: [
        { id: 't1', label: 'Time 1 (HH:MM)', type: 'text', placeholder: '10:00' },
        { id: 'op', label: 'Operation (+/-)', type: 'text' },
        { id: 't2', label: 'Time 2 (HH:MM)', type: 'text', placeholder: '02:30' }
      ], formula: (i) => {
        const p = t => { const [h,m]=t.split(':').map(Number); return (h*60)+m; };
        const toT = m => `${Math.floor(m/60)}:${m%60}`;
        let res = i.op === '+' ? p(i.t1) + p(i.t2) : p(i.t1) - p(i.t2);
        return `Result: ${toT(res)}`;
      }},
      { id: 'gpa', name: 'GPA Calculator', category: 'other', inputs: [
        { id: 'grades', label: 'Grades (A=4, B=3...)', type: 'text', placeholder: '4, 3, 3.5' }
      ], formula: (i) => {
        const arr = i.grades.split(',').map(Number);
        const gpa = arr.reduce((a,b)=>a+b,0)/arr.length;
        return `GPA: ${gpa.toFixed(2)}`;
      }},
      { id: 'concrete', name: 'Concrete Calculator', category: 'other', inputs: [
        { id: 'l', label: 'Length (ft)', type: 'number' },
        { id: 'w', label: 'Width (ft)', type: 'number' },
        { id: 'd', label: 'Depth (in)', type: 'number' }
      ], formula: (i) => {
        const cubicFt = i.l * i.w * (i.d/12);
        const yards = cubicFt / 27;
        return `Need: ${yards.toFixed(2)} Cubic Yards`;
      }},
      { id: 'ip', name: 'IP Subnet Calculator', category: 'other', inputs: [
        { id: 'ip', label: 'IP Address', type: 'text', placeholder: '192.168.1.1' },
        { id: 'cidr', label: 'CIDR (e.g. 24)', type: 'number' }
      ], formula: (i) => {
        // Very simplified logic
        const parts = i.ip.split('.');
        parts[3] = '0';
        return `Network: ${parts.join('.')} / ${i.cidr}`;
      }}
    ];


    // --- STATE & LOGIC ---
    let state = {
      user: null,
      activeCalc: null,
      activeCategory: 'all',
      search: ''
    };

    // --- RENDERING ---
    const grid = document.getElementById('calcGrid');
    const emptyState = document.getElementById('emptyState');
    
    function renderCalculators() {
      let filtered = calculators;
      if(state.activeCategory !== 'all') filtered = filtered.filter(c => c.category === state.activeCategory);
      if(state.search) filtered = filtered.filter(c => c.name.toLowerCase().includes(state.search.toLowerCase()));
      
      if(!filtered.length) {
        grid.innerHTML = '';
        emptyState.classList.remove('hidden');
        return;
      }
      
      emptyState.classList.add('hidden');
      grid.innerHTML = filtered.map(c => `
        <div class="calc-card bg-[var(--card)]" onclick="openCalc('${c.id}')">
          <span class="text-[10px] uppercase tracking-widest text-[var(--muted)]">${c.category}</span>
          <h3 class="font-semibold text-sm font-display mt-1">${c.name}</h3>
        </div>
      `).join('');
    }

    function openCalc(id) {
      const calc = calculators.find(c => c.id === id);
      if(!calc) return;
      
      state.activeCalc = calc;
      document.getElementById('modalTitle').textContent = calc.name;
      document.getElementById('modalCategory').textContent = calc.category;
      
      // Generate Inputs
      const interfaceEl = document.getElementById('calcInterface');
      interfaceEl.innerHTML = calc.inputs.map(inp => `
        <div>
          <label class="input-label">${inp.label}</label>
          <input type="${inp.type}" id="input_${inp.id}" class="input-field" placeholder="${inp.placeholder || ''}" value="">
        </div>
      `).join('');
      
      document.getElementById('resultDisplay').textContent = '0';
      document.getElementById('calcModal').classList.add('active');
    }

    function closeCalcModal() {
      document.getElementById('calcModal').classList.remove('active');
      state.activeCalc = null;
    }

    function calculateResult() {
      if(!state.activeCalc) return;
      
      const inputs = {};
      state.activeCalc.inputs.forEach(inp => {
        const val = document.getElementById('input_' + inp.id).value;
        inputs[inp.id] = inp.type === 'number' ? parseFloat(val) : val;
      });
      
      try {
        const result = state.activeCalc.formula(inputs);
        document.getElementById('resultDisplay').textContent = result;
      } catch(e) {
        document.getElementById('resultDisplay').textContent = 'Error in calculation';
      }
    }

    // --- AUTH & UI CONTROLS ---
    const authArea = document.getElementById('authArea');
    
    function updateAuthUI() {
      if(state.user) {
        authArea.innerHTML = `
          <div class="relative">
            <button onclick="toggleMenu()" class="user-avatar">${state.user.name[0]}</button>
            <div id="userMenu" class="hidden absolute right-0 mt-2 w-40 glass-panel border border-[var(--border)]">
              <div class="p-3 border-b border-[var(--border)]">
                <p class="text-xs font-bold">${state.user.name}</p>
                <p class="text-[10px] text-[var(--muted)]">${state.user.email}</p>
              </div>
              <button onclick="signOut()" class="w-full text-left px-3 py-2 text-xs text-[var(--danger)] hover:bg-[var(--card)]">Sign Out</button>
            </div>
          </div>`;
      } else {
        authArea.innerHTML = `<button onclick="openAuth()" class="btn-secondary text-xs py-2 px-4">Sign In</button>`;
      }
    }

    function openAuth() { document.getElementById('authModal').classList.add('active'); }
    function closeAuthModal() { document.getElementById('authModal').classList.remove('active'); }
    function toggleMenu() { document.getElementById('userMenu').classList.toggle('hidden'); }
    
    function signIn(provider) {
      state.user = { name: provider === 'google' ? 'Google User' : 'GitHub User', email: 'user@example.com' };
      localStorage.setItem('calcilab_user', JSON.stringify(state.user));
      updateAuthUI();
      closeAuthModal();
    }

    function signOut() {
      state.user = null;
      localStorage.removeItem('calcilab_user');
      updateAuthUI();
    }

    function resetView() {
      state.activeCategory = 'all';
      state.search = '';
      document.getElementById('headerSearch').value = '';
      document.querySelectorAll('.category-pill').forEach(b => b.classList.remove('active'));
      document.querySelector('[data-category="all"]').classList.add('active');
      renderCalculators();
    }

    function handleSearch(v) { state.search = v; renderCalculators(); }

    // --- EVENTS ---
    document.getElementById('categoriesContainer').addEventListener('click', e => {
      if(e.target.classList.contains('category-pill')) {
        document.querySelectorAll('.category-pill').forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        state.activeCategory = e.target.dataset.category;
        renderCalculators();
      }
    });

    // Close menu on outside click
    document.addEventListener('click', e => {
      if (!e.target.closest('#authArea')) {
        const menu = document.getElementById('userMenu');
        if(menu) menu.classList.add('hidden');
      }
    });

    // Check session
    const savedUser = localStorage.getItem('calcilab_user');
    if(savedUser) { state.user = JSON.parse(savedUser); updateAuthUI(); }

    // --- CANVAS ANIMATION ---
    const canvas = document.getElementById('networkCanvas');
    const ctx = canvas.getContext('2d');
    let particles = [];

    function initCanvas() {
      canvas.width = window.innerWidth; canvas.height = window.innerHeight;
      particles = [];
      for(let i=0; i<50; i++) particles.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, vx: (Math.random()-0.5)*1, vy: (Math.random()-0.5)*1 });
    }

    function animate() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      particles.forEach(p => {
        p.x+=p.vx; p.y+=p.vy;
        if(p.x<0||p.x>canvas.width) p.vx*=-1;
        if(p.y<0||p.y>canvas.height) p.vy*=-1;
        ctx.beginPath(); ctx.arc(p.x,p.y,2,0,Math.PI*2); ctx.fillStyle='rgba(0, 255, 200, 0.4)'; ctx.fill();
      });
      // Draw lines
      for(let i=0; i<particles.length; i++) {
        for(let j=i+1; j<particles.length; j++) {
          const d = Math.hypot(particles[i].x - particles[j].x, particles[i].y - particles[j].y);
          if(d < 150) {
            ctx.beginPath(); ctx.moveTo(particles[i].x, particles[i].y); ctx.lineTo(particles[j].x, particles[j].y);
            ctx.strokeStyle = `rgba(0, 255, 200, ${0.1 - d/1500})`; ctx.stroke();
          }
        }
      }
      requestAnimationFrame(animate);
    }

    window.addEventListener('resize', initCanvas);
    initCanvas();
    animate();
    renderCalculators();

  </script>
</body>
</html>
